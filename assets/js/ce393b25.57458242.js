"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2235],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),m=a,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},1578:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={sidebar_position:6},i="Iteration Operator",l={unversionedId:"operators/iteration",id:"operators/iteration",title:"Iteration Operator",description:"The iteration operator allows a user to do to iterative streams, such as a recursive join in a tree structure.",source:"@site/docs/operators/iteration.md",sourceDirName:"operators",slug:"/operators/iteration",permalink:"/flowtide/docs/operators/iteration",draft:!1,editUrl:"https://github.com/koralium/flowtide/tree/main/docs/docs/operators/iteration.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Aggregate Operator",permalink:"/flowtide/docs/operators/aggregate"},next:{title:"Expressions",permalink:"/flowtide/docs/category/expressions"}},s={},p=[{value:"Iteration Relation",id:"iteration-relation",level:2},{value:"Iteration Reference Read Relation",id:"iteration-reference-read-relation",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Metrics",id:"metrics",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"iteration-operator"},"Iteration Operator"),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"iteration operator")," allows a user to do to iterative streams, such as a recursive join in a tree structure.\nThe operator is not defined as a standard operator in substrait. So this uses custom relations."),(0,a.kt)("p",null,"It is defined by two different relations:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"IterationRelation"),(0,a.kt)("li",{parentName:"ul"},"IterationReferenceReadRelation")),(0,a.kt)("h2",{id:"iteration-relation"},"Iteration Relation"),(0,a.kt)("p",null,"The iteration relation uses ExtensionMultiRel in substrait and is defined as follows in protobuf:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"message IterationRelation {\n    string iterationName = 1;\n}\n")),(0,a.kt)("p",null,"The first input in ExtensionMultiRel is the loop relation, the second input is input to the iteration itself.\nThe second input is optional."),(0,a.kt)("p",null,"IterationName exist since there can be multiple nested iterations."),(0,a.kt)("h2",{id:"iteration-reference-read-relation"},"Iteration Reference Read Relation"),(0,a.kt)("p",null,"This relation is used to tell where the data from the iteration operator should be sent to inside of the loop.\nThis relation should only be used inside the loop relation."),(0,a.kt)("p",null,"It is defined by ExtensionLeafRel and has the following message:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"message IterationReferenceReadRelation {\n    // Name of the iteration to get data from\n    string iterationName = 1;\n}\n")),(0,a.kt)("h2",{id:"implementation"},"Implementation"),(0,a.kt)("p",null,"The iteration operator differs a bit from the other operators in how it does checkpointing.\nTo make sure a checkpoint contains all processed data before comitting to a checkpoint it follows these steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"If there is no input to the operator, a dummy read operator is created that only sends checkpoint events."),(0,a.kt)("li",{parentName:"ol"},"On checkpoint send a LockingEventPrepare to the loop."),(0,a.kt)("li",{parentName:"ol"},"All operators in loop adds information if they have another dependency that is not yet in checkpoint."),(0,a.kt)("li",{parentName:"ol"},"If any message was recieved before the iteration operator recieves the LockingEventPrepare message, or a dependency is not in checkpoint, the message is resent."),(0,a.kt)("li",{parentName:"ol"},"When all conditions above are met, the checkpoint is sent throught the loop."),(0,a.kt)("li",{parentName:"ol"},"When the operator recieves the checkpoint from the loop, it first sends out watermark information, and then the checkpoint to the rest of the stream.")),(0,a.kt)("h2",{id:"metrics"},"Metrics"),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Iteration Operator")," has the following metrics:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"busy"),(0,a.kt)("td",{parentName:"tr",align:null},"Gauge"),(0,a.kt)("td",{parentName:"tr",align:null},"Value 0-1 on how busy the operator is.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"backpressure"),(0,a.kt)("td",{parentName:"tr",align:null},"Gauge"),(0,a.kt)("td",{parentName:"tr",align:null},"Value 0-1 on how much backpressure the operator has.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"health"),(0,a.kt)("td",{parentName:"tr",align:null},"Gauge"),(0,a.kt)("td",{parentName:"tr",align:null},"Value 0 or 1, if the operator is healthy or not.")))),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"At this point, an iteration operator will never be unhealthy.\nIf there is a failure against the state, the stream will instead restart.")))}d.isMDXComponent=!0}}]);