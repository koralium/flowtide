"use strict";(self.webpackChunkflowtide=self.webpackChunkflowtide||[]).push([[470],{1406:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>M,contentTitle:()=>j,default:()=>o,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"connectors/sqlserver","title":"SQL Server Connector","description":"The SQL Server connector has three different parts:","source":"@site/docs/connectors/sqlserver.md","sourceDirName":"connectors","slug":"/connectors/sqlserver","permalink":"/flowtide/docs/connectors/sqlserver","draft":false,"unlisted":false,"editUrl":"https://github.com/koralium/flowtide/tree/main/docs/docs/connectors/sqlserver.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Catalogs","permalink":"/flowtide/docs/connectors/catalogs"},"next":{"title":"Delta Lake Connector","permalink":"/flowtide/docs/connectors/deltalake"}}');var r=i(4848),s=i(8453);const a={sidebar_position:1},j="SQL Server Connector",M={},l=[{value:"Supported Data Types",id:"supported-data-types",level:2},{value:"Source",id:"source",level:2},{value:"Sink",id:"sink",level:2},{value:"Custom Primary Keys",id:"custom-primary-keys",level:3},{value:"SQL Table Provider",id:"sql-table-provider",level:2}];function L(e){const t={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"sql-server-connector",children:"SQL Server Connector"})}),"\n",(0,r.jsx)(t.p,{children:"The SQL Server connector has three different parts:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Source"})," - Reads data from a SQL Server table."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Sink"})," - Writes results from a stream into a SQL Server table."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Table Provider"})," - Provides table information to the SQL plan builder."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"supported-data-types",children:"Supported Data Types"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"SQL Server connector"})," supports reading and writing the following data types:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Int"}),"\n",(0,r.jsx)(t.li,{children:"BigInt"}),"\n",(0,r.jsx)(t.li,{children:"Binary"}),"\n",(0,r.jsx)(t.li,{children:"Bit"}),"\n",(0,r.jsx)(t.li,{children:"Char"}),"\n",(0,r.jsx)(t.li,{children:"Date"}),"\n",(0,r.jsx)(t.li,{children:"Datetime"}),"\n",(0,r.jsx)(t.li,{children:"Datetime2"}),"\n",(0,r.jsx)(t.li,{children:"Decimal"}),"\n",(0,r.jsx)(t.li,{children:"Float"}),"\n",(0,r.jsx)(t.li,{children:"Image"}),"\n",(0,r.jsx)(t.li,{children:"Money"}),"\n",(0,r.jsx)(t.li,{children:"Nchar"}),"\n",(0,r.jsx)(t.li,{children:"Ntext"}),"\n",(0,r.jsx)(t.li,{children:"Numeric"}),"\n",(0,r.jsx)(t.li,{children:"Nvarchar"}),"\n",(0,r.jsx)(t.li,{children:"Real"}),"\n",(0,r.jsx)(t.li,{children:"Smalldatetime"}),"\n",(0,r.jsx)(t.li,{children:"Smallint"}),"\n",(0,r.jsx)(t.li,{children:"Text"}),"\n",(0,r.jsx)(t.li,{children:"Time"}),"\n",(0,r.jsx)(t.li,{children:"Tinyint"}),"\n",(0,r.jsx)(t.li,{children:"Uniqueidentifier"}),"\n",(0,r.jsx)(t.li,{children:"Varbinary"}),"\n",(0,r.jsx)(t.li,{children:"Varchar"}),"\n",(0,r.jsx)(t.li,{children:"Xml"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"source",children:"Source"}),"\n",(0,r.jsx)(t.p,{children:"The SQL Server Source allows Flowtide to fetch rows and updates from a SQL Server table.\nThere is one prerequisite for this connector to work:"}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsx)(t.p,{children:"Change tracking must be enabled on the table."})}),"\n",(0,r.jsx)(t.p,{children:"Without change tracking, Flowtide wont be able to find updates on the table.\nThere are plans to allow the source to run in batch mode where it computes the delta inside of the connector, but\nthat is not yet available."}),"\n",(0,r.jsx)(t.p,{children:"The SQL Server Source can be added to the 'ConnectorManager' with the following line:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"connectorManager.AddSqlServerSource(() => connectionString);\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The connection string must be set as a function, since the idea is that the connection string might change, from say a system such as\n",(0,r.jsx)(t.em,{children:"Hashicorp Vault"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The source uses the following logic to fetch data into the stream:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2MDAgMTgwIj4KICA8cGF0aAogICAgZmlsbD0iI2FhYSIKICAgIGQ9Ik05Mi4xNyAzOS43NWMtLjE4LjIxIDAgLjk5Ljk3IDQuMTEuNzcgMi41Ljk1IDMuNy42OCA0LjY2LS4yMy44Mi0uNjEgMS4xOC0xLjYgMS40OS0uNDIuMTMtLjg2LjI4LS45OC4zMi0uMTIuMDQtLjM3LjAxLS41NS0uMDYtLjU5LS4yNC0xLjcxLTIuMTUtMi41Mi00LjMxLTEuNjMtNC4zNS0zLjc2LTE0LjQyLTUuNy0yNi45LS42MS0zLjk0LS43My01Ljc2LS40Ni02LjcxLjIyLS43OC45MS0xLjY2IDEuNTEtMS45Ny45OC0uNSAxLjM3LS41IDIuMzYtLjAzLjQ3LjIyNi43ODYuMzQzIDEuMDAyLjU2Mi40NDkuNDU1LjQ1NiAxLjM0Ni40OCA0LjU2NWwuMDA4Ljk2M2MuMDMgMy42My4xMiA1LjYuMyA3LjA1LjQxIDMuMTQuNTkgNC4wMi44NyA0LjA4LjE1LjAyLjc4LS42IDEuNjktMS42NyAxLjg3LTIuMjIgNS4wNC01LjI4IDYuNDMtNi4yIDEuODMtMS4yMyAyLjg2LTEuNjMgNC4xMi0xLjY0LjgzIDAgMS4yNS4wOCAxLjc5LjM1LjkzLjQ2IDEuMTYuOTUuOTkgMi4wN2wtLjEzLjg2LTIuMjcgMi4wNWMtMy43NSAzLjM5LTcuMTIgNy4wNy04LjMgOS4wOS0uNDkuODMtLjQ1IDEuMTIuMTYgMS4yNS41Ni4xMiA3Ljc1IDIuNjIgMTAuNDEgMy42MSAxLjE2LjQ0IDIuNjcuOTggMy4zNSAxLjIgMS42LjUzIDEuOTEuODYgMS45OSAyLjEuMTggMi43Mi0xLjExIDMuNTQtNC43OSAzLjA2LTMuMzYtLjQ0LTYuMDUtMS4yOS05LjQ5LTMuMDMtMS42NC0uODMtMi4yMS0xLjA2LTIuMzItLjkyWk0yMy4xOCAxNC45Yy0yLjk3IDAtNS42Ni44NC03LjkgMi40Ni0xLjc4IDEuMy02LjUxIDYuNDEtNy40NCA4LjA1LS40Ny44My0uODQgMS4wNC0xLjE1LjY0LS40NS0uNTctLjgtMi43NC0xLjAyLTYuMzEtLjMzLTUuNTMtLjUyLTYuNTUtMS41Mi04LjI1bC0uNDEtLjctLjc0LjA4Yy0xLjYuMTktMi41MSAxLjA5LTIuODcgMi44MS0uMjggMS4zMS0uMDkgNS4yNy4zNiA3LjcyIDEuNDQgNy44IDQuMiAxNy44NSA2LjU3IDIzLjg4IDEuMTYgMi45NSAyLjIyIDQuODQgMi45NyA1LjMuNjUuMzkgMS4yNS4zNyAyLjE4LS4xIDEuMDQtLjUxIDEuNDktMS4wOCAxLjcxLTIuMTMuNDMtMi4wOC0uMTEtNC4wMS0xLjk2LTcuMDgtMS40NS0yLjM5LTEuODUtMy4zMS0xLjg4LTQuMzQtLjA0LTEuMS4yMS0xLjI2IDEuNTgtMS4wNCAyLjIuMzcgNC4yOCAxLjM5IDguOSA0LjM3IDUuMTEgMy4zMSA3LjE1IDQuMjIgOS45MiA0LjQ4IDEuMzIuMTIgMS43LS4wNSAyLjE2LS45Ni40Mi0uODQuNDctMi40OS4xLTMuMjgtLjUxLTEuMDctMy40NC0zLjAzLTguMTQtNS40Mi00LjEyLTIuMTEtMTAuNjMtNC45Ni0xMi40Ni01LjQ1LS4xMS0uMDMtLjItLjE4LS4yLS4zMyAwLS40MSAzLjUzLTMuOTIgNi4yMi02LjE4IDIuNTgtMi4xOCA0LjQ2LTQuMDkgNS4xLTUuMTYuMjItLjM4LjQ5LTEuMTEuNTktMS42MWwuMDIzLS4xMWMuMTU4LS43NTQuMjI4LTEuMDg0LjA5NS0xLjIyOC0uMTAzLS4xMTItLjMyOS0uMTEyLS43My0uMTEyaC0uMDU4Wm05MC4yOC0uNWMxLjA1LjY1IDEuNzQgMS43MSAxLjgyIDIuNzcuMDMuNDgtLjAxIDEtLjEgMS4xNy0uNDUuODMtMi4xIDEtNC4yNi40NWwtMS4yOS0uMzMuMDUtLjgzYy4xLTIuMTEuNzktMy4xOCAyLjI0LTMuNDguODEtLjE3Ljg3LS4xNiAxLjU0LjI1Wm0xLjg4IDEwLjdjLjQ2LS4xMS40OC0uMDQuNjUgMS45Ny4xNiAxLjg2LjUyIDMuNjggMS41MSA3LjYzIDEuOTMgNy43IDIuNSAxMC43MSAyLjUgMTMuMiAwIDEuMzEtLjQyIDIuMjgtMS4xNiAyLjcxLS41OC4zMy0xLjc0LjQ1LTIuNTIuMjUtMS4zLS4zMi0yLjA5LTEuMDctMi45OC0yLjg1LTEuNDctMi45Mi0yLjI3LTkuNjYtMi4wNC0xNy4wNGwuMTEtMy4zNS41My0uNjJjLjUxLS42IDIuNDEtMS42NiAzLjQtMS45Wm0tNTguMTUgNy41OGMuNDctMi4yNC0xLTQuNzQtMy40NC01Ljg4LS44NS0uNC0xLjI0LS40OC0yLjQtLjUzLTIuNTMtLjEyLTQuMDEuNDUtNS44MSAyLjI0LTEuNTQgMS41Mi0zLjI2IDQuNC0zLjc4IDYuMzQtLjI1LjkyLS42NC44Mi0xLjA2LS4yNi0uNjQtMS42MS0yLjI0LTQuNzktMi45MS01Ljc4LS45LTEuMzMtMS40OC0xLjcxLTIuNDUtMS42Mi0xLjI3LjEyLTEuOSAxLjE0LTEuOSAzLjA1IDAgMy40NyAzLjk0IDEyLjg5IDcuMiAxNy4yMyAxLjYgMi4xMiAyLjYzIDMuMDIgMy44MiAzLjM0Ljg5LjI0LjkyLjI0IDEuODMuMDUuODItLjE4IDEuNTgtLjg2IDEuNzctMS41OS4xOS0uNzktLjA2LTMuMTgtLjU2LTUuMi0uNDYtMS44NS0uNTEtMi4yMy0uNDktNC4xNS4wMy00LjIxIDEuMDMtNi42NiAyLjk2LTcuMi4zNS0uMS43OS0uMzIuOTgtLjQ4LjQ0LS4zOS41OS0uMjcgMS41IDEuMjlsLjcxIDEuMjEgMS4wMS0uMDhjMS44Ny0uMTYgMi43Ni0uNzQgMy4wMi0xLjk4Wm0uNyA1LjE1Yy44Ni0zLjgzIDQtNy41NiA4LjA4LTkuNjIgMi40OC0xLjI1IDQuNTctMS44MSA3LjE5LTEuOTIgMi40OC0uMTEgMy4xOC4xNCA0Ljc4IDEuNzUgMi4zMiAyLjMyIDMuNiA1LjcyIDMuNDIgOS4wNy0uMSAxLjkxLS4zOSAzLjAxLTEuMTcgNC41OC0xLjcxIDMuNDItNC41NyA2LjIxLTguMDkgNy45LTIuMzEgMS4xMS01LjA1IDEuNTktNy4yNiAxLjI4LTMuNzItLjUxLTYuMTctMy4wNi02Ljk4LTcuMjMtLjI5LTEuNTEtLjI3LTQuNDUuMDMtNS44MVptNy4xMS0uMWMtMS41NSAxLjg0LTEuOSAyLjU3LTEuOSAzLjkgMCAyLjA3Ljc4IDMuMjIgMi40OSAzLjY3Ljc3LjIgMi42Ni4wNCAzLjU0LS4zMiAxLjI2LS40OSAyLjQtMS4zMSAzLjczLTIuNjQgMS4zMy0xLjM1IDIuMDQtMi40MyAyLjYtMy45Ny42Ny0xLjg0LjYxLTMuOTctLjE1LTUuNDctLjQ1LS45Mi0uOTgtMS4yNy0xLjg1LTEuMjYtMS44LjAzLTUuNzcgMi44OS04LjQ2IDYuMDlaIgogIC8+CiAgPHRleHQgeT0iODAiIGZpbGw9IiNhYWEiIGZvbnQtc2l6ZT0iMTQiPkZhaWwsIHBsZWFzZSBjaGVjayB5b3VyIGlucHV0LjwvdGV4dD4KICA8Zm9yZWlnbk9iamVjdCB3aWR0aD0iNjAwIiBoZWlnaHQ9IjgwIiB5PSI5MCIgZm9udC1zaXplPSIxNCI+CiAgICA8ZGl2CiAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIgogICAgICBzdHlsZT0iY29sb3I6I2ZmMjIwMDt3b3JkLWJyZWFrOmJyZWFrLWFsbCIKICAgID4KICAgICAgPCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgogICAgPHRpdGxlPktyb2tpITwvdGl0bGU+CiAgICA8c3R5bGU+CiAgICAgICAgaHRtbCwKICAgICAgICBib2R5LAogICAgICAgIHAsCiAgICAgICAgaDEsCiAgICAgICAgaDIgewogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgfQoKICAgICAgICBoMSwKICAgICAgICBoMiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTAwJTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICAgICAgICB9CgogICAgICAgIGh0bWwgewogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgKiwgKjo6YmVmb3JlLCAqOjphZnRlciB7CiAgICAgICAKICAgIDwvZGl2PgogIDwvZm9yZWlnbk9iamVjdD4KPC9zdmc+Cg==",alt:"blockdiag"})}),"\n",(0,r.jsx)(t.p,{children:"The source will retry fetching data in-case of a SQL Server error, as long as it can reconnect to the database.\nIt will mark the operator as unhealthy, but it will not trigger a stream restart."}),"\n",(0,r.jsx)(t.p,{children:"If the operator cannot reconnect to the SQL Server, it will trigger a full stream restart."}),"\n",(0,r.jsx)(t.h2,{id:"sink",children:"Sink"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"SQL Server Sink"})," implements the ",(0,r.jsx)(t.em,{children:"grouped write operator"}),". This means that all rows are grouped by a primary key, thus all\nsink tables must have a primary key defined."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsx)(t.p,{children:"All SQL Server Sink tables must have a primary key defined. The primary key must also be in the query that fills the table."})}),"\n",(0,r.jsx)(t.p,{children:"Its implementation waits fully until the stream has reached a steady state at a time T until it writes data to the database.\nThis means that its table output can always be traced back to a state from the source systems."}),"\n",(0,r.jsxs)(t.p,{children:["To use the ",(0,r.jsx)(t.em,{children:"SQL Server Sink"})," add the following line to the ",(0,r.jsx)(t.em,{children:"ConnectorManager"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"connectorManager.AddSqlServerSink(() => connectionString);\n"})}),"\n",(0,r.jsxs)(t.p,{children:["As with the ",(0,r.jsx)(t.em,{children:"SQL Server Source"}),", the connection string is returned by a function to enable dynamic connection strings."]}),"\n",(0,r.jsxs)(t.p,{children:["The sink inserts data into ",(0,r.jsx)(t.em,{children:"SQL Server"})," by creating a temporary table, which follows the table structure of the destination with an added operation metadata column.\nThe data is inserted into the temporary table using ",(0,r.jsx)(t.em,{children:"Bulk Copy"}),". This allows for fast binary insertion into the temporary table."]}),"\n",(0,r.jsx)(t.p,{children:"After data has been inserted into the temporary table, a merge into statement is run that merges data into the destination table.\nAfter all data has been merged, the temporary table is cleared of all data."}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:"If there are multiple rows in the result with the same primary key, only the latest seen row will be inserted into the destination table."})}),"\n",(0,r.jsx)(t.h3,{id:"custom-primary-keys",children:"Custom Primary Keys"}),"\n",(0,r.jsx)(t.p,{children:"In some scenarios you may want to override the table's primary keys or the table might not have a primary key configured.\nIn this scenario you can provide column names for the columns you want Flowtide to use as primary keys."}),"\n",(0,r.jsx)(t.p,{children:"Ex:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'connectorManager.AddSqlServerSink("your regexp on table names", new SqlServerSinkOptions() {\n  ConnectionStringFunc = () => connectionString,\n  CustomPrimaryKeys = new List<string>() { "my_column1", "my_column2" }\n});\n'})}),"\n",(0,r.jsx)(t.h2,{id:"sql-table-provider",children:"SQL Table Provider"}),"\n",(0,r.jsxs)(t.p,{children:["The SQL table provider is added to the ",(0,r.jsx)(t.em,{children:"SQL plan builder"})," which will try and look after used tables in its configured ",(0,r.jsx)(t.em,{children:"SQL Server"}),".\nIt provides metadata information about what the column names are in the table."]}),"\n",(0,r.jsxs)(t.p,{children:["To use the ",(0,r.jsx)(t.em,{children:"table provider"})," add the following line to the ",(0,r.jsx)(t.em,{children:"Sql plan builder"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:"sqlBuilder.AddSqlServerProvider(() => connectionString);\n"})}),"\n",(0,r.jsx)(t.p,{children:"If you are starting Flowtide with dependency injection, a table provider is added automatically, so this step is not required."})]})}function o(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(L,{...e})}):L(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>j});var n=i(6540);const r={},s=n.createContext(r);function a(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function j(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);